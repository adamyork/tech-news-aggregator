/**This content is derived. Do not edit.**/

"use strict";const express=require("express"),cheerio=require("cheerio"),und=require("underscore-node"),axios=require("axios");let app=express();app.set("view engine","ejs"),app.set("views",__dirname),app.get("/",(e,t)=>{t.render("index.ejs",{layout:!1})});let toTitleCase=function(e){var t=e.split(" ");return(t=und.map(t,e=>{let t=e.substr(0,1),s=e.substr(1,e.length);return t.toUpperCase()+s})).join(" ")},getResource=function(e,t){axios.get("https://"+e.host+e.path).then(e=>{t(e.data)}).catch(e=>{t(e,!0)})},processDom=function(e,t,s){let r=s(cheerio.load(e));t.send({articles:r})},mapRequest=function(e,t,s,r,o){app.get(e,function(e,a){getResource({host:t,path:s},(e,t)=>{t?a.send({articles:[{href:"",desc:e}]}):o?processDom(e,a,r):a.send({articles:r(e)})})})},postProcessHackerNews=function(e){var t=e(".athing td:nth-child(3) a");return t=und.map(t,e=>{let t=e.attribs.href;return{href:-1===t.indexOf("item?id=")?t:"https://news.ycombinator.com/"+t,desc:toTitleCase(e.children[0].data||"broken")}}),t=und.filter(t,e=>"Broken"!==e.desc)},postProcessLobsters=function(e){var t=e(".link a");return t=und.map(t,e=>({href:e.attribs.href,desc:toTitleCase(e.children[0].data)}))},postProcessArstechnica=function(e){var t=e(".tease.article > a").toArray();return t=und.map(t,e=>{let t=e.attribs.href.toString().split("/"),s=t[t.length-2].split("-").join(" ");return{href:e.attribs.href,desc:toTitleCase(s)}})},postProcessSlashdot=function(e){var t=e(".story span:first-child a").toArray();return t=und.map(t,e=>({href:e.attribs.href,desc:toTitleCase(e.children[0].data)})),t=und.filter(t,e=>{return!RegExp("\\(.+\\.","g").test(e.desc)})};mapRequest("/hn","news.ycombinator.com","/",postProcessHackerNews,!0),mapRequest("/lob","lobste.rs","/",postProcessLobsters,!0),mapRequest("/ars","arstechnica.com","/",postProcessArstechnica,!0),mapRequest("/sd","slashdot.org","/",postProcessSlashdot,!0),app.use("/",express.static(__dirname)),app.listen(8080),console.log("local application server started on port 8080."),console.log("ctrl-c to exit.");
/**End Content**/