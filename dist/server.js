/**This content is derived. Do not edit.**/
var express=require("express"),http=require("http"),https=require("https"),jsdom=require("jsdom"),app=express(),und=require("underscore-node");app.set("view engine","ejs"),app.set("views",__dirname),app.get("/",function(a,b){b.render("index.ejs",{layout:!1})});var _toTitleCase=function(a){var b=a.split(" ");return b=und.map(b,function(a){var b=a.substr(0,1),c=a.substr(1,a.length);return b.toUpperCase()+c}),b.join(" ")},_getResource=function(a,b,c){var d=b.get(a,function(a){var b=[];a.on("data",function(a){b.push(a)}),a.on("end",function(){var a=Buffer.concat(b);c(a)}),d.on("error",function(a){c(a.message,!0)})})},_mapRequest=function(a,b,c,d,e,f){app.get(a,function(a,g){_getResource({host:b,path:c},d,function(a,b){return b?void g.send({articles:[{href:"",desc:a}]}):void(f?_processDom(a,g,e):g.send({articles:e(a)}))})})},_processDom=function(a,b,c){console.log("about to process the body "),jsdom.env({html:a,scripts:["../bower_components/jquery/dist/jquery.js"],done:function(a,d){if(a){var e="An error occured when processing the document.\n";return und.each(a,function(a){e+=a.message+"\n"}),void b.send({articles:[{href:"",desc:e}]})}var f=d.$,g=c(f);b.send({articles:g})}})},_postProcessHackerNews=function(a){try{var b=JSON.parse(a).items;return b=und.map(b,function(a){return{href:a.url,desc:_toTitleCase(a.title)}})}catch(c){var b=[{href:"",desc:"An error occured when processing the document."}];return b}},_postProcessLobsters=function(a){var b=a(".link a");return b=und.map(b,function(a){return{href:a.href,desc:_toTitleCase(a.innerHTML)}})},_postProcessArstechnica=function(a){var b=a(".post article > a").toArray();return b=und.map(b,function(a){var b=a.href.toString(),c=b.split("/"),d=c[c.length-2],e=d.split("-").join(" ");return{href:a.href,desc:_toTitleCase(e)}})},_postProcessSlashdot=function(a){var b=a(".story-header h1 a");return b=und.map(b,function(a){var b=a.href.replace("file","http");return{href:b,desc:_toTitleCase(a.innerHTML)}})};_mapRequest("/hn","api.ihackernews.com","/page",http,_postProcessHackerNews),_mapRequest("/lob","lobste.rs","/",https,_postProcessLobsters,!0),_mapRequest("/ars","arstechnica.com","/",http,_postProcessArstechnica,!0),_mapRequest("/sd","beta.slashdot.org","/",http,_postProcessSlashdot,!0),app.use("/",express.static(__dirname)),app.listen(8080),console.log("local application server started on port 8080."),console.log("ctrl-c to exit.");
/**End Content**/